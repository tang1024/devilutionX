<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Devilution: Project background</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Devilution
   </div>
   <div id="projectbrief">Diablo devolved - magic behind the 1996 computer game</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Project background </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To give further background, the Devilution team has primarily relied on these resources:</p>
<ol type="1">
<li>The Japanese Playstation port with debug symbols contained in <code>DIABPSX.SYM</code>. (see [<a href="https://github.com/diasurgical/scalpel/blob/master/psx/_dump_/_dump_merge_c_src_/diabpsx/source/drlg_l1.cpp">1</a>]).</li>
</ol>
<p>Example debug info of the Cathedral dungeon generation algorithm:</p>
<div class="fragment"><div class="line"><span class="comment">// address: 0x801259D0</span></div>
<div class="line"><span class="comment">// line start: 612</span></div>
<div class="line"><span class="comment">// line end:   624</span></div>
<div class="line"><span class="keywordtype">void</span> DRLG_L1Floor__Fv() {</div>
<div class="line"><span class="comment">// register: 19</span></div>
<div class="line"><span class="keyword">register</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="comment">// register: 20</span></div>
<div class="line"><span class="keyword">register</span> <span class="keywordtype">int</span> j;</div>
<div class="line"><span class="comment">// register: 3</span></div>
<div class="line"><span class="keyword">register</span> <span class="keywordtype">long</span> rv;</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>The debug release of the PE executable, which contained assert strings (see [<a href="http://diablo1.se/notes/debug.html">2</a>]).</li>
</ol>
<p>Example assert string:</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;plr[myplr].InvGrid[i] &lt;= plr[myplr]._pNumInv&quot;</span></div>
</div><!-- fragment --><ol type="1">
<li>The Rich header of the PE executable, which details the exact version of the original compilers and linkers used to build <code>Diablo.exe</code> (see [<a href="https://github.com/diasurgical/devilution/issues/111#issuecomment-426059660">3</a>], [<a href="http://bytepointer.com/articles/the_microsoft_rich_header.htm">4</a>]).</li>
</ol>
<p>Example information recovered from the Rich header of <code>Diablo.exe</code>:</p>
<div class="fragment"><div class="line">Id  Build  Count  Name       Description</div>
<div class="line"> 0      0    155  Unknown    [---] Number of imported functions (old)</div>
<div class="line"> 1      0    229  Import0    [---] Number of imported functions</div>
<div class="line"> 6   1668      1  Cvtres500  [RES] VS97 (5.0) SP3 cvtres 5.00.1668</div>
<div class="line"> 2   7303     29  Linker510  [IMP] VS97 (5.0) SP3 link 5.10.7303</div>
<div class="line"> 3   7303      1  Cvtomf510        VS97 (5.0) SP3 cvtomf 5.10.7303</div>
<div class="line"> 4   8447      2  Linker600  [LNK] VC++ 6.0 SP3,SP4,SP5,SP6 link 6.00.8447</div>
<div class="line">48   9044     72  Utc12_2_C  [---] VC++ 6.0 SP5 Processor Pack</div>
<div class="line">19   9049     12  Linker512        Microsoft LINK 5.12.9049</div>
</div><!-- fragment --><ol type="1">
<li>Discovery of the original set of compiler flags used to build <code>Diablo.exe</code> (see [<a href="https://github.com/diasurgical/devilution/issues/111">5</a>]).</li>
</ol>
<p>Primarily "/O1" was used, but there are also peculiarities such as the use of both Microsoft Visual Studio 6 and Microsoft Visual Code 5 for linking the game.</p>
<ol type="1">
<li>The heartfelt dedication of a team of people. GalaXyHaXz did the initial heavy lifting and succeeded in the tremendous task of getting the decompiled source code of Diablo 1 compiling with the original toolchain. Later on she released the project open source and a community of open source collaborators formed. Most of us have never met in real life prior to joining the project, which stands to show that there is strength in online collaboration that transcend both culture and borders.</li>
<li>The Beta release and the Alpha4 release of Diablo 1 has also proved invaluable resources for cross-validation as the compiler optimization level was not set to release mode for these binaries.</li>
</ol>
<p>Interestingly, in the process a number of bugs in the original implementation of Diablo 1 were discovered. These have been documented in the source code of Devilution with <code>// BUGFIX: foo</code> comments, and have also been detailed in [<a href="https://github.com/diasurgical/devilution/issues/64">6</a>].</p>
<p>To track the progress of the project, the "Binary identical functions" milestone has been used in tandem with an assembly diffing tool developed in Rust (see [<a href="https://github.com/diasurgical/devilution/milestone/3">7</a>], [<a href="https://github.com/diasurgical/devilution-comparer">8</a>]).</p>
<p>Anecdotally, it was an incredible moment when we first managed to run the cross-platform port of Diablo 1 (DevilutionX, see [<a href="https://github.com/diasurgical/devilutionX">9</a>]) natively on Linux and succeeded in playing a multiplayer game connecting our computers in Korea and Denmark. It is equally thrilling to see the modding and porting community picking up the torch and already succeeding in porting Diablo 1 to Nintendo Switch!</p>
<p>The main reason for conducting this bit of software archeology is to preserve the classic title that is Diablo 1, for generations to come. And to revive it for modern hardware platforms and make it more mod-friendly in the age of open source software.</p>
<p>Happy coding! - The Devilution Team</p>
<p>P.S. the project README explicitly states that to play the game, you still need to have access to the original game assets released on the Diablo 1 CD. To acquire a legal copy, please refer to <a href="https://www.gog.com/game/diablo">https://www.gog.com/game/diablo</a></p>
<p>P.P.S. for the verification process, there have been proposals that are both ambitious at a level of PhD research (see [<a href="https://github.com/diasurgical/devilution/issues/171">10</a>]) and that made us feel warm and fuzzy &lt;3 In the end, many of the techniques outlined were discussed mostly on a design level, some were included as Proof of Concepts, but most of the work in reverse engineering Diablo 1 was from tender labour of a team that care for Diablo 1 the way you would your firstborn child.</p>
<p>P.P.P.S. you can also view our presentation slides here: <a href="https://docs.google.com/presentation/d/1ghmOFFgA3MfuJALMo8hmfNCL6pWWaW3plAbRtmSwfXY/edit?usp=sharing">https://docs.google.com/presentation/d/1ghmOFFgA3MfuJALMo8hmfNCL6pWWaW3plAbRtmSwfXY/edit?usp=sharing</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
